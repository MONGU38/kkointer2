<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>꼬꼬너 - 꼬리에 꼬리를 물어 찾은 너</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b35 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .floating-memory {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
            font-size: 2rem;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.1; }
            50% { opacity: 0.3; }
            90% { opacity: 0.1; }
        }

        .app-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .main-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .app-title {
            font-size: 3rem;
            background: linear-gradient(135deg, #667eea, #764ba2, #ff6b35);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(118, 75, 162, 0.6)); }
        }

        .app-subtitle {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .app-description {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(255, 107, 53, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            line-height: 1.6;
        }

        .app-description::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .progress-container {
            margin: 20px 0;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .login-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .category-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-card {
            background: white;
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 20px 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #667eea;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }

        .category-card:hover::before {
            opacity: 0.1;
        }

        .category-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            transform: scale(1.02);
        }

        .category-icon {
            font-size: 2rem;
            position: relative;
            z-index: 1;
        }

        .category-title {
            font-weight: 600;
            color: #333;
            position: relative;
            z-index: 1;
            font-size: 1.1rem;
        }

        .sub-category {
            margin-top: 15px;
            display: none;
        }

        .sub-category.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .sub-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .sub-category-card {
            background: rgba(102, 126, 234, 0.05);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sub-category-card:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .sub-category-card.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .question-section {
            display: none;
            margin-top: 30px;
        }

        .question-section.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .question-card.active {
            border-color: #667eea;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
        }

        .question-subtitle {
            font-size: 1rem;
            background: linear-gradient(135deg, #ffeb3b, #ffc107);
            color: #b8860b;
            margin-bottom: 20px;
            font-weight: 600;
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid #ffc107;
            text-align: center;
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 15px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-weight: 500;
        }

        .tag:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .tag.selected {
            background: linear-gradient(135deg, #ff6b35, #ff8f65);
            transform: scale(1.05);
        }

        .additional-input {
            margin-top: 10px;
        }

        .additional-input input {
            width: 100%;
            padding: 12px 15px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }

        .additional-input input:focus {
            border-color: #667eea;
            border-style: solid;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.4);
        }

        .matching-results {
            display: none;
            margin-top: 30px;
        }

        .matching-results.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .match-list {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .match-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .match-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .match-info {
            flex: 1;
        }

        .match-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .match-details {
            font-size: 0.9rem;
            color: #666;
        }

        .match-percentage {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .comparison-section {
            display: none;
            margin-top: 30px;
        }

        .comparison-section.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .comparison-table {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .comparison-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .comparison-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .question-title {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
        }

        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .my-answer-section {
            text-align: center;
        }

        .partner-answer-section {
            text-align: center;
        }

        .answer-label {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .my-answer-label {
            color: #667eea;
        }

        .partner-answer-label {
            color: #ff6b35;
        }

        .answer-content {
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 500;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.4;
        }

        .my-answer {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(102, 126, 234, 0.05));
            border: 2px solid rgba(102, 126, 234, 0.2);
            color: #333;
        }

        .partner-answer {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 107, 53, 0.05));
            border: 2px solid rgba(255, 107, 53, 0.2);
            color: #333;
        }

        .chat-room {
            display: none;
        }

        .chat-room.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            text-align: center;
            font-weight: 600;
        }

        .chat-messages {
            background: white;
            padding: 20px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #667eea;
            border-top: none;
        }

        .chat-input-area {
            background: white;
            padding: 20px;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 15px 15px;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 70%;
            line-height: 1.4;
        }

        .message.sent {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.received {
            background: #f1f3f4;
            color: #333;
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }

            .main-card {
                padding: 20px;
                margin: 0;
                max-height: none;
                min-height: auto;
                width: 100%;
                max-width: 100%;
            }
            
            .app-title {
                font-size: 2rem;
                margin-bottom: 8px;
            }

            .answer-comparison {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .comparison-item {
                padding: 15px;
            }

            .question-title {
                font-size: 1rem;
                padding: 10px 15px;
            }

            .answer-content {
                padding: 12px 15px;
                min-height: 45px;
                font-size: 0.9rem;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="bg-animation" id="bgAnimation"></div>

    <div class="app-container">
        <div class="main-card">
            <div class="app-header">
                <h1 class="app-title sparkle">🔗 꼬꼬너</h1>
                <p class="app-subtitle">꼬리에 꼬리를 물어 찾은 너</p>
                <div class="app-description">
                    <strong>꼬꼬너는 룰 방식으로 당신의 기억을 더듬어서<br>
                    그리운 사람을 찾는 데 도움을 드립니다.</strong><br><br>
                    이름, 연락처, 사진 등 명확한 정보가 없어도<br>
                    어렴풋한 기억만으로 인연을 찾을 수 있는 새로운 방식의 플랫폼입니다.
                </div>
            </div>

            <div class="login-section" id="loginSection">
                <button class="btn btn-primary" onclick="startApp()">로그인</button>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">베타 버전으로 간편하게 시작하세요</p>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="category-section hidden" id="mainCategorySection">
                <h3 class="section-title">안녕하세요. 찾고 싶은 사람을 선택해주세요.</h3>
                <div class="category-grid">
                    <div class="category-card" onclick="selectMainCategory('missing')">
                        <span class="category-icon">👶</span>
                        <div class="category-title">실종아동(가족)</div>
                    </div>
                    <div class="category-card" onclick="selectMainCategory('separated')">
                        <span class="category-icon">👴</span>
                        <div class="category-title">이산가족</div>
                    </div>
                    <div class="category-card" onclick="selectMainCategory('friends')">
                        <span class="category-icon">👥</span>
                        <div class="category-title">그리운친구</div>
                    </div>
                </div>

                <div class="sub-category" id="friendsSubCategory">
                    <div class="sub-category-grid">
                        <div class="sub-category-card" onclick="selectSubCategory('neighborhood')">동네친구</div>
                        <div class="sub-category-card" onclick="selectSubCategory('school')">학교친구</div>
                        <div class="sub-category-card" onclick="selectSubCategory('military')">군대친구</div>
                        <div class="sub-category-card" onclick="selectSubCategory('work')">직장친구</div>
                    </div>
                </div>

                <div class="sub-category" id="schoolSubCategory">
                    <div class="sub-category-grid">
                        <div class="sub-category-card" onclick="selectSchoolType('kindergarten')">유치원</div>
                        <div class="sub-category-card" onclick="selectSchoolType('elementary')">초등학교</div>
                        <div class="sub-category-card" onclick="selectSchoolType('middle')">중학교</div>
                        <div class="sub-category-card" onclick="selectSchoolType('high')">고등학교</div>
                        <div class="sub-category-card" onclick="selectSchoolType('university')">대학교/대학원</div>
                        <div class="sub-category-card" onclick="selectSchoolType('other')">기타</div>
                    </div>
                </div>

                <div class="sub-category" id="missingSubCategory">
                    <div class="sub-category-grid">
                        <div class="sub-category-card" onclick="selectMissingType('child')">실종아동</div>
                        <div class="sub-category-card" onclick="selectMissingType('family')">실종가족</div>
                    </div>
                </div>
            </div>

            <div class="question-section" id="questionSection">
                <div class="question-card active">
                    <p class="question-subtitle">사례 중에서 여러개 선택해도 되며 해당 사항이 없으면 빈칸에 입력해 주세요. 입력 자료가 많을 경우 반드시 쉼표로 구분해 주세요.</p>
                    
                    <div id="questionsContainer">
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="startMatching()" id="startMatchingBtn">매칭 시작하기</button>
                    </div>
                </div>
            </div>

            <div class="matching-results" id="matchingResults">
                <div class="match-list">
                    <h3 style="margin-bottom: 20px; color: #333;">매칭 결과</h3>
                    <div id="matchList">
                    </div>
                </div>
            </div>

            <div class="comparison-section" id="comparisonSection">
                <div class="comparison-table">
                    <h3 style="margin-bottom: 25px; color: #333; text-align: center; font-size: 1.3rem;">상세 비교 정보</h3>
                    <div id="comparisonContent">
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="proceedToChat()">채팅방 입장하기</button>
                        <button class="btn btn-secondary" onclick="goBackToMatching()">다른 매칭 보기</button>
                    </div>
                </div>
            </div>

            <div class="chat-room" id="chatRoom">
                <div class="chat-header">
                    <h3 id="chatPartnerName">김○○님과의 대화</h3>
                </div>
                <div class="chat-messages" id="chatMessages">
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chatInput" placeholder="메시지를 입력하세요..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">전송</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 'login';
        let selectedCategory = '';
        let selectedSubCategory = '';
        let selectedSchoolType = '';
        let answers = {};
        let currentPartner = null;
        let chatStep = 0;

        const missingChildQuestions = [
            {
                id: 'name',
                question: '당신의 이름과 별명을 알려주세요.',
                type: 'text',
                placeholder: '예: 김철수, 철이'
            },
            {
                id: 'lastMemoryAge',
                question: '가족들과 마지막 기억은 몇 살 때였나요?',
                type: 'text',
                placeholder: '예: 5살, 7세'
            },
            {
                id: 'bodyFeatures',
                question: '몸에 점이나 상처 등 특징은 있었나요?',
                type: 'textarea',
                placeholder: '예: 왼쪽 어깨에 동전 크기 점, 오른손 검지에 작은 상처'
            },
            {
                id: 'houseStructure',
                question: '살던 집은 어떤 구조였나요?',
                type: 'tags',
                options: ['양옥', '한옥', '아파트', '연립주택', '단독주택']
            },
            {
                id: 'doorFeatures',
                question: '대문 색깔과 재질은 무엇이었나요?',
                type: 'tags',
                options: ['나무', '철', '파란색', '초록색', '갈색', '회색']
            },
            {
                id: 'stairs',
                question: '집 앞에 계단은 있었나요? 개수는?',
                type: 'text',
                placeholder: '예: 3개, 계단 없음'
            },
            {
                id: 'nearbyPlaces',
                question: '근처에 있었던 장소는?',
                type: 'tags',
                options: ['약국', '경찰서', '기찻길', '우물', '마을회관', '상점', '학교']
            },
            {
                id: 'religiousItems',
                question: '종교 관련 물건(십자가, 불상 등)은 있었나요?',
                type: 'textarea',
                placeholder: '예: 거실에 십자가, 방에 불상'
            },
            {
                id: 'yard',
                question: '마당이나 텃밭이 있었나요?',
                type: 'text',
                placeholder: '예: 앞마당 있음, 뒷마당에 텃밭'
            },
            {
                id: 'yardItems',
                question: '마당에는 무엇이 있었나요?',
                type: 'tags',
                options: ['연못', '화장실', '강아지집', '장독대', '화단', '우물', '나무']
            }
        ];

        const friendQuestions = [
            {
                id: 'targetName',
                question: '찾고 계신 분의 이름이나 별명을 알려주세요.',
                type: 'text',
                placeholder: '예: 김철수, 철이'
            },
            {
                id: 'whenMet',
                question: '언제 만났던 기억이 있나요?',
                type: 'text',
                placeholder: '예: 2010년 여름, 고등학교 1학년 때'
            },
            {
                id: 'whereMet',
                question: '어디서 만났나요?',
                type: 'text',
                placeholder: '예: 서울시 강남구, 부산 해운대'
            },
            {
                id: 'appearance',
                question: '그 분의 외모 특징은?',
                type: 'tags',
                options: ['키 큰', '키 작은', '뚱뚱한', '마른', '안경 착용', '곱슬머리', '직모', '쌍꺼풀', '단발머리', '긴머리']
            },
            {
                id: 'personality',
                question: '성격은 어땠나요?',
                type: 'tags',
                options: ['활발한', '조용한', '유머러스한', '진지한', '친절한', '리더십 있는', '수줍은', '대담한']
            },
            {
                id: 'hobbies',
                question: '취미나 특기가 있었나요?',
                type: 'tags',
                options: ['축구', '농구', '음악', '그림', '독서', '게임', '요리', '춤', '수영', '태권도']
            },
            {
                id: 'features',
                question: '그 분의 특징이나 기억나는 것들을 자유롭게 써주세요.',
                type: 'textarea',
                placeholder: '함께했던 일들, 기타 기억나는 모든 것들...'
            }
        ];

        const sampleAnswers = {
            missing: {
                name: '김철수',
                doorFeatures: ['파란색', '나무'],
                houseStructure: ['단독주택'],
                stairs: '3개',
                nearbyPlaces: ['상점', '우물'],
                yardItems: ['장독대', '나무'],
                lastMemoryAge: '7살',
                bodyFeatures: '왼쪽 어깨에 동전 크기 점',
                religiousItems: '거실에 십자가',
                yard: '앞마당 있음'
            },
            friends: {
                targetName: '최민수',
                appearance: ['키 큰', '안경 착용'],
                personality: ['활발한', '유머러스한'],
                hobbies: ['축구', '음악'],
                whenMet: '2015년 봄',
                whereMet: '서울시 강남구',
                features: '항상 웃고 있었고, 축구를 정말 잘했어요. 같이 PC방도 자주 갔던 기억이 나네요.'
            }
        };

        function initBackgroundAnimation() {
            const bgAnimation = document.getElementById('bgAnimation');
            const memories = ['💭', '❤️', '🌟', '📚', '🎵', '⚽', '🎮', '✨', '🌈', '💫', '🎯', '🔍', '💡', '🏠', '👨‍👩‍👧‍👦', '🎪'];
            
            setInterval(() => {
                const memory = document.createElement('div');
                memory.className = 'floating-memory';
                memory.textContent = memories[Math.floor(Math.random() * memories.length)];
                memory.style.left = Math.random() * 100 + '%';
                memory.style.animationDelay = Math.random() * 2 + 's';
                memory.style.animationDuration = (15 + Math.random() * 10) + 's';
                
                bgAnimation.appendChild(memory);
                
                setTimeout(() => {
                    if (memory.parentNode) {
                        memory.parentNode.removeChild(memory);
                    }
                }, 25000);
            }, 3000);
        }

        function startApp() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainCategorySection').classList.remove('hidden');
            document.getElementById('progressContainer').style.display = 'block';
            updateProgress(20);
            currentStep = 'category';
        }

        function selectMainCategory(category) {
            selectedCategory = category;
            
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.target.closest('.category-card').classList.add('selected');
            
            hideAllSubCategories();
            if (category === 'friends') {
                document.getElementById('friendsSubCategory').classList.add('active');
            } else if (category === 'missing') {
                document.getElementById('missingSubCategory').classList.add('active');
            } else {
                setTimeout(() => {
                    startQuestions();
                }, 500);
            }
            
            updateProgress(40);
        }

        function selectSubCategory(subCategory) {
            selectedSubCategory = subCategory;
            
            document.querySelectorAll('#friendsSubCategory .sub-category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // 학교친구가 아닌 경우 상위 카테고리 숨기기
            if (subCategory !== 'school') {
                document.getElementById('friendsSubCategory').style.display = 'none';
                setTimeout(() => {
                    startQuestions();
                }, 500);
            } else {
                // 학교친구인 경우 다른 옵션들 숨기고 학교 세부 카테고리만 표시
                const otherCards = document.querySelectorAll('#friendsSubCategory .sub-category-card');
                otherCards.forEach(card => {
                    if (!card.classList.contains('selected')) {
                        card.style.display = 'none';
                    }
                });
                document.getElementById('schoolSubCategory').classList.add('active');
            }
            
            updateProgress(60);
        }

        function selectSchoolType(schoolType) {
            selectedSchoolType = schoolType;
            
            document.querySelectorAll('#schoolSubCategory .sub-category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            setTimeout(() => {
                startQuestions();
            }, 500);
            
            updateProgress(80);
        }

        function selectMissingType(missingType) {
            selectedSubCategory = missingType;
            
            document.querySelectorAll('#missingSubCategory .sub-category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            setTimeout(() => {
                startQuestions();
            }, 500);
            
            updateProgress(80);
        }

        function hideAllSubCategories() {
            document.querySelectorAll('.sub-category').forEach(sub => {
                sub.classList.remove('active');
            });
        }

        function startQuestions() {
            document.getElementById('mainCategorySection').classList.add('hidden');
            document.getElementById('questionSection').classList.add('active');
            
            if (selectedCategory === 'missing' && selectedSubCategory === 'child') {
                loadMissingChildQuestions();
            } else {
                loadFriendQuestions();
            }
            
            updateProgress(90);
        }

        function loadMissingChildQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            missingChildQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'form-group';
                questionDiv.style.animationDelay = `${index * 0.1}s`;
                
                let inputHTML = '';
                if (q.type === 'text') {
                    inputHTML = `<input type="text" class="form-input" id="${q.id}" placeholder="${q.placeholder}">`;
                } else if (q.type === 'textarea') {
                    inputHTML = `<textarea class="form-textarea" id="${q.id}" placeholder="${q.placeholder}"></textarea>`;
                } else if (q.type === 'tags') {
                    inputHTML = `
                        <div class="tag-container">
                            ${q.options.map(option => `<button class="tag" onclick="toggleTag(this, '${q.id}', '${option}')">${option}</button>`).join('')}
                        </div>
                        <div class="additional-input">
                            <input type="text" placeholder="기타 입력 (쉼표로 구분)" id="${q.id}_additional">
                        </div>
                    `;
                }
                
                questionDiv.innerHTML = `
                    <label class="form-label">${q.question}</label>
                    ${inputHTML}
                `;
                
                container.appendChild(questionDiv);
            });
        }

        function loadFriendQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            friendQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'form-group';
                questionDiv.style.animationDelay = `${index * 0.1}s`;
                
                let inputHTML = '';
                if (q.type === 'text') {
                    inputHTML = `<input type="text" class="form-input" id="${q.id}" placeholder="${q.placeholder}">`;
                } else if (q.type === 'textarea') {
                    inputHTML = `<textarea class="form-textarea" id="${q.id}" placeholder="${q.placeholder}"></textarea>`;
                } else if (q.type === 'tags') {
                    inputHTML = `
                        <div class="tag-container">
                            ${q.options.map(option => `<button class="tag" onclick="toggleTag(this, '${q.id}', '${option}')">${option}</button>`).join('')}
                        </div>
                        <div class="additional-input">
                            <input type="text" placeholder="기타 입력 (쉼표로 구분)" id="${q.id}_additional">
                        </div>
                    `;
                }
                
                questionDiv.innerHTML = `
                    <label class="form-label">${q.question}</label>
                    ${inputHTML}
                `;
                
                container.appendChild(questionDiv);
            });
        }

        function toggleTag(element, questionId, value) {
            element.classList.toggle('selected');
            
            if (!answers[questionId]) {
                answers[questionId] = [];
            }
            
            const index = answers[questionId].indexOf(value);
            if (index > -1) {
                answers[questionId].splice(index, 1);
            } else {
                answers[questionId].push(value);
            }
        }

        function startMatching() {
            // 일반 입력 필드 수집
            document.querySelectorAll('.form-input, .form-textarea').forEach(input => {
                if (input.value.trim()) {
                    answers[input.id] = input.value.trim();
                }
            });

            // 기타 입력 필드 수집
            document.querySelectorAll('[id$="_additional"]').forEach(input => {
                if (input.value.trim()) {
                    const questionId = input.id.replace('_additional', '');
                    if (!answers[questionId]) {
                        answers[questionId] = [];
                    }
                    const additionalValues = input.value.split(',').map(v => v.trim()).filter(v => v);
                    answers[questionId] = [...answers[questionId], ...additionalValues];
                }
            });
            
            console.log('수집된 답변:', answers);
            
            const btn = document.getElementById('startMatchingBtn');
            const originalText = btn.textContent;
            btn.innerHTML = '<span style="display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite;"></span> 매칭 중...';
            btn.disabled = true;
            
            setTimeout(() => {
                showMatchingResults();
                btn.innerHTML = originalText;
                btn.disabled = false;
                updateProgress(100);
            }, 3000);
        }

        function showMatchingResults() {
            document.getElementById('questionSection').classList.remove('active');
            document.getElementById('matchingResults').classList.add('active');
            
            const matchList = document.getElementById('matchList');
            
            if (selectedCategory === 'missing' && selectedSubCategory === 'child') {
                matchList.innerHTML = `
                    <div class="match-item" onclick="showComparison('김○○', 1)">
                        <div class="match-info">
                            <div class="match-name">김○○</div>
                            <div class="match-details">비슷한 시기, 비슷한 지역 • 집 구조 일치</div>
                        </div>
                        <div class="match-percentage">87%</div>
                    </div>
                    <div class="match-item" onclick="showComparison('이○○', 2)">
                        <div class="match-info">
                            <div class="match-name">이○○</div>
                            <div class="match-details">마당 특징 일치 • 근처 장소 유사</div>
                        </div>
                        <div class="match-percentage">73%</div>
                    </div>
                    <div class="match-item" onclick="showComparison('박○○', 3)">
                        <div class="match-info">
                            <div class="match-name">박○○</div>
                            <div class="match-details">집 앞 계단 개수 일치 • 대문 색깔 유사</div>
                        </div>
                        <div class="match-percentage">65%</div>
                    </div>
                `;
            } else {
                matchList.innerHTML = `
                    <div class="match-item" onclick="showComparison('최○○', 1)">
                        <div class="match-info">
                            <div class="match-name">최○○</div>
                            <div class="match-details">같은 시기, 같은 지역 • 학교 일치 가능성</div>
                        </div>
                        <div class="match-percentage">91%</div>
                    </div>
                    <div class="match-item" onclick="showComparison('정○○', 2)">
                        <div class="match-info">
                            <div class="match-name">정○○</div>
                            <div class="match-details">비슷한 특징 • 이름 유사성</div>
                        </div>
                        <div class="match-percentage">78%</div>
                    </div>
                `;
            }
        }

        function showComparison(partnerName, partnerId) {
            currentPartner = { name: partnerName, id: partnerId };
            
            document.getElementById('matchingResults').classList.remove('active');
            document.getElementById('comparisonSection').classList.add('active');
            
            const content = document.getElementById('comparisonContent');
            let comparisonHTML = '';
            
            const currentSample = selectedCategory === 'missing' ? sampleAnswers.missing : sampleAnswers.friends;
            const partnerSample = selectedCategory === 'missing' ? 
                { ...sampleAnswers.missing, doorFeatures: ['파란색', '철'], nearbyPlaces: ['경찰서', '상점'] } :
                { ...sampleAnswers.friends, appearance: ['키 큰', '직모'], personality: ['활발한', '친절한'] };
            
            const questions = selectedCategory === 'missing' ? missingChildQuestions : friendQuestions;
            
            questions.forEach(q => {
                const myAnswer = answers[q.id] || currentSample[q.id] || '정보 없음';
                const partnerAnswer = partnerSample[q.id] || '정보 없음';
                
                const myAnswerStr = Array.isArray(myAnswer) ? myAnswer.join(', ') : myAnswer;
                const partnerAnswerStr = Array.isArray(partnerAnswer) ? partnerAnswer.join(', ') : partnerAnswer;
                
                comparisonHTML += `
                    <div class="comparison-item">
                        <div class="question-title">${q.question}</div>
                        <div class="answer-comparison">
                            <div class="my-answer-section">
                                <div class="answer-label my-answer-label">나의 답변</div>
                                <div class="answer-content my-answer">${myAnswerStr}</div>
                            </div>
                            <div class="partner-answer-section">
                                <div class="answer-label partner-answer-label">${currentPartner.name}님의 답변</div>
                                <div class="answer-content partner-answer">${partnerAnswerStr}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = comparisonHTML;
        }

        function proceedToChat() {
            document.getElementById('comparisonSection').classList.remove('active');
            document.getElementById('chatRoom').classList.add('active');
            document.getElementById('chatPartnerName').textContent = `${currentPartner.name}님과의 대화`;
            
            startChatSequence();
        }

        function goBackToMatching() {
            document.getElementById('comparisonSection').classList.remove('active');
            document.getElementById('matchingResults').classList.add('active');
        }

        function startChatSequence() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            chatStep = 0;
            
            const partnerQuestions = [
                "안녕하세요! 매칭되어서 연락드립니다. 혹시 저를 기억하시나요?",
                "정말 반갑네요! 혹시 그때 그 곳에서 자주 만났던 기억이 있으신가요?",
                "맞는 것 같아요! 그런데 혹시 그때 함께했던 특별한 추억이 있으신지요?"
            ];
            
            setTimeout(() => {
                addMessage(partnerQuestions[0], 'received');
            }, 1000);
        }

        function addMessage(text, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'sent');
            input.value = '';
            
            chatStep++;
            
            const partnerResponses = [
                "정말 기쁩니다! 저도 그때가 생각나네요.",
                "네, 맞아요! 정말 오랜만이에요. 그때 정말 재미있었는데...",
                "와, 정말 놀라워요! 이렇게 다시 만나게 되다니... 정말 감사합니다! 🎉"
            ];
            
            if (chatStep <= partnerResponses.length) {
                setTimeout(() => {
                    addMessage(partnerResponses[chatStep - 1], 'received');
                    
                    if (chatStep < 3) {
                        const nextQuestions = [
                            "그런데 혹시 그때 자주 만났던 장소가 기억나시나요?",
                            "저도 그래요! 그때 우리가 함께했던 일 중에 가장 기억에 남는 건 뭔가요?"
                        ];
                        
                        setTimeout(() => {
                            addMessage(nextQuestions[chatStep - 1], 'received');
                        }, 1500);
                    } else {
                        setTimeout(() => {
                            addMessage("앞으로도 계속 연락하며 지내요! 정말 기뻐요! 😊", 'received');
                        }, 2000);
                    }
                }, 1000);
            }
        }

        function updateProgress(percentage) {
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        window.addEventListener('load', function() {
            initBackgroundAnimation();
        });
    </script>
</body>
</html>
